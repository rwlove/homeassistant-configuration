name: "Run Action"
on:
  push:
    branch:
      - master
  pull_request:
    branch:
      - master

jobs:
  check:
    name: Home Assistant Config Check
    runs-on: ubuntu-latest
    steps:
    - name: Checkout Home Assistant Configuration
      uses: actions/checkout@master
      with:
        path: config
    - name: Clone private secrets repository
      uses: actions/checkout@v2.3.1
      with:
        repository: rwlove/homeassistant-secrets
        ref: master
        token: ${{ secrets.GITHUBPAT }} # `GitHub_PAT` is a secret that contains your PAT
        path: secrets
    - name: mkdir ${{ github.workspace }}/custom_components
      run: sudo mkdir ${{ github.workspace }}/custom_components
    - name: Clone sonoff
      uses: actions/checkout@v2.3.1
      with:
        repository: peterbuga/HASS-sonoff-ewelink
        path: ${{ github.workspace }}/HASS-sonoff-ewelink
    - name: ln -s /HASS-sonoff-ewelink/sonoff /custom_components/sonoff
      run: sudo ln -s ${{ github.workspace }}/HASS-sonoff-ewelink/sonoff ${{ github.workspace }}/custom_components/sonoff
    - name: Clone Wyzesense
      uses: actions/checkout@v2.3.1
      with:
        repository: kevinvincent/ha-wyzesense
        path: ${{ github.workspace }}/ha-wyzesense
    - name: ln -s /ha-wyzesense/custom_components/wyzesense /custom_components/wyzesense
      run: sudo ln -s ${{ github.workspace }}/ha-wyzesense/custom_components/wyzesense ${{ github.workspace }}/custom_components/wyzesense
    - name: Add HACS
      working-directory: ${{ github.workspace }}/config
      run: wget -qO- https://hacs.xyz/install | bash -x -
    - name: ls
      working-directory: ${{ github.workspace }}
      run: ls -la
    - name: ls -la config/
      working-directory: ${{ github.workspace }}
      run: ls -la config/
    - name: ls -la secrets/
      working-directory: ${{ github.workspace }}  
      run: ls -la secrets/
    - name: ls -la custom_components/
      working-directory: ${{ github.workspace }}  
      run: ls -la custom_components/
    - name: Run Config Check
      uses: ludeeus/action-ha-config-check@master
      with:
        config_path: config
